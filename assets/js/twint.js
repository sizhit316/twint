jQuery(document).ready(function(e){function t(t){e("."+o+"-setup-page").addClass("hidden"),e("#"+o+"-setup-page-"+t).removeClass("hidden"),e("."+o+"-multi-steps .step").removeClass("is-active"),e("#"+o+"-multi-step-"+t).addClass("is-active"),e("."+o+"-setup-assistant-btn").addClass("hidden"),5==t&&e("#"+o+"-close-btn").removeClass("hidden"),t>1&&e("#"+o+"-back-btn").removeClass("hidden"),t<3&&e("#"+o+"-next-btn").removeClass("hidden")}function a(){e("#"+o+"-setup-assistant-field").addClass("hidden"),e("#"+o+"-settings-fields").removeClass("hidden"),e("#"+o+"-start-setup-button").removeClass("hidden"),e("button[name='save']").show()}function n(){e("#mame_tw-upload_file_button-wrapper").hide(),e("#mame_tw-certificate-loader").show()}function s(){e("#mame_tw-upload_file_button-wrapper").show(),e("#mame_tw-certificate-loader").hide()}function i(t){n(),e.when(e.post(twintVars.ajaxUrl,{mame_tw_action:"enroll",action:"mametw_ajax",security:twintVars.ajaxNonce,environment:t}).then(function(e){s();var t=JSON.parse(e);1==t.status?new MameToast(t.message,"success"):new MameToast(t.message,"error")}))}var o=twintVars.prefix,r=function(e){this.actions={},this.handleResponse(e)};r.prototype={handleResponse:function(t){if("undefined"!=typeof t.replace&&this.replace(t.replace.element,t.replace["with"]),"undefined"!=typeof t.replaceText&&this.replaceText(t.replaceText.element,t.replaceText["with"]),"undefined"!=typeof t.remove&&this.remove(t.remove),"undefined"!=typeof t.html&&this.html(t.html),"undefined"!=typeof t.text&&this.text(t.text),"undefined"!=typeof t.action&&this.callAction(t.action),"undefined"!=typeof t.attr&&this.attr(t.attr),"undefined"!=typeof t.addClass&&this.addClass(t.addClass),"undefined"!=typeof t.removeClass&&this.removeClass(t.removeClass),"undefined"!=typeof t.data&&this.data(t.data),"undefined"!=typeof t.append&&this.append(t.append.to,t.append.element),"undefined"!=typeof t.hide&&this.hide(t.hide),"undefined"!=typeof t.show){var a=null;"undefined"!=typeof t.showScrollTo&&null!=t.showScrollTo&&"null"!=t.showScrollTo&&(a=t.showScrollTo),this.show(t.show,a)}"undefined"!=typeof t.after&&this.after(t.after),"undefined"!=typeof t.redirect&&this.redirect(t.redirect),"undefined"!=typeof t.scrollTo&&this.scrollTo(t.scrollTo),"undefined"!=typeof t.errors&&this.errors(t.errors);var n=this;e.each(this.actions,function(e,a){"undefined"!=typeof t.action&&t.action==e&&n.callAction(e)})},scrollTo:function(t){e("html, body").animate({scrollTop:e(t.target).offset().top},500)},replace:function(t,a){e(t).replaceWith(a)},replaceText:function(e,t){e.text(t)},remove:function(e){e.remove()},append:function(t,a){e(t).append(a)},html:function(t){e.each(t,function(t,a){e(a.element).html(a.content)})},text:function(t){e.each(t,function(t,a){e(a.element).text(a.text)})},attr:function(t){e.each(t,function(t,a){e(a.elem).attr(a.attr,a.val)})},addClass:function(t){e.each(t,function(t,a){e(a.elem).addClass(a["class"])})},removeClass:function(t){e.each(t,function(t,a){e(a.elem).removeClass(a["class"])})},hide:function(t){e.each(t,function(t,a){e(a).hide()})},show:function(t,a){if(e.each(t,function(t,a){e(a).show()}),null!=a){var n=e(a);"undefined"!=typeof n&&e("html, body").animate({scrollTop:n.offset().top},500)}},after:function(t){e.each(t,function(t,a){e(a.element).after(a.insert)})},redirect:function(e){window.location=e},errors:function(t){e.each(t,function(t,a){var n=a.container,s=a.errors;0===t&&e(n).empty(),e.each(s,function(t,a){e(n).append("<p>"+a+"</p>")})})},data:function(t){e.each(t,function(t,a){e(a.elem).data(a.attr,a.val)})},addAction:function(e,t){this.actions[e]=t},callAction:function(e){this.actions.hasOwnProperty(e)&&this.actions[e]()}};var c=e("#"+o+"-setup-assistant-wrapper").data("page");e(document).on("click","#"+o+"-next-btn, #mame_tw-enroll_register",function(a){a.preventDefault(),e("#"+o+"-setup-assistant-errors").empty();var n=e("#"+o+"-setup-page-"+c),s=e(this);s.prop("disabled",!0),s.addClass("loading");var i={action:"mametw_ajax",mame_tw_action:"save_setup_step",form:n.find("select, textarea, input").serialize(),page:c,security:twintVars.ajaxNonce};e.ajax({type:"POST",url:twintVars.ajaxUrl,data:i,success:function(e){s.prop("disabled",!1),s.removeClass("loading");var a=JSON.parse(e);a.status&&(t(++c),new MameToast(a.message,"success")),new r(a)},error:function(e){s.prop("disabled",!1),new MameToast("error in request","error")}})}),e(".mame_tw-certificate_upload_button").click(function(a){a.preventDefault(),e("#"+o+"-setup-assistant-errors").empty();var n=e(this).data("environment"),s=wp.media.editor.send.attachment,i=e(this);return wp.media.editor.send.attachment=function(a,o){e(i).prev().val(o.id),wp.media.editor.send.attachment=s;var l={action:"mametw_ajax",mame_tw_action:"save_setup_step",form:e.param({attachment_id:o.id,environment:n}),page:c,security:twintVars.ajaxNonce};e.ajax({type:"POST",url:twintVars.ajaxUrl,data:l,success:function(e){var a=JSON.parse(e);a.status&&(t(++c),new MameToast(a.message,"success")),new r(a)},error:function(e){i.prop("disabled",!1),new MameToast("error in request","error")}})},wp.media.editor.open(i),!1}),e(document).on("click","#mame_tw-cancel-setup-button",function(t){t.preventDefault();var n=confirm(twintVars.texts.confirmCloseSetupAssistant);if(n){var s={action:"mametw_ajax",mame_tw_action:"cancel_setup",page:c,security:twintVars.ajaxNonce};e.ajax({type:"POST",url:twintVars.ajaxUrl,data:s,success:function(e){var t=JSON.parse(e);t.status&&a()},error:function(e){caller.prop("disabled",!1),new MameToast("error in request","error")}})}}),e(document).on("click","."+o+"-editor-skip-button",function(e){e.preventDefault(),t(++c)}),e(document).on("click","#"+o+"-back-btn",function(a){a.preventDefault(),e("#"+o+"-setup-assistant-errors").empty(),t(--c)}),e(document).on("click","#"+o+"-close-btn",function(e){e.preventDefault(),a()}),e(document).on("click","#"+o+"-start-setup-button",function(a){a.preventDefault(),e(this).addClass("hidden"),e("#"+o+"-setup-assistant-field").removeClass("hidden"),e("#"+o+"-settings-fields").addClass("hidden"),c=1,t(c),e("button[name='save']").hide()}),e("#"+o+"-setup-complete").length&&(e("#"+o+"-setup-complete").data("value")||e("button[name='save']").hide()),e(document).on("click",".mame_tw-modal-close",function(t){t.preventDefault(),e("#mame_tw-modal").addClass("hidden")}),e(document).on("click","#mame_tw-check-logs-btn",function(t){t.preventDefault(),e("#mame_tw-modal").removeClass("hidden")}),e(document).mouseup(function(t){var a=e("#mame_tw-modal #mame_tw-modal-content");a.is(t.target)||0!==a.has(t.target).length||e("#mame_tw-modal").addClass("hidden")}),e(document).on("click","#"+o+"-enable-gateway-toggle",function(t){t.preventDefault();var a=e(this);if(!e(this).hasClass("woocommerce-input-toggle--loading")){e(this).addClass("woocommerce-input-toggle--loading");var n={action:"mametw_ajax",mame_tw_action:"toggle_enable",security:twintVars.ajaxNonce};e.ajax({type:"POST",url:twintVars.ajaxUrl,data:n,success:function(e){var t=JSON.parse(e);new r(t),a.removeClass("woocommerce-input-toggle--loading")},error:function(t){e(this).removeClass("woocommerce-input-toggle--loading")}})}}),e(document).on("click","#mame_tw-check-order-status-btn",function(t){t.preventDefault();var a=e(this),n=a.data("order-id");a.prop("disabled",!0),e.when(e.post(twintVars.ajaxUrl,{action:"mametw_ajax",mame_tw_action:"check_order_status",security:twintVars.ajaxNonce,order_id:n}).then(function(e){a.prop("disabled",!1);var t=JSON.parse(e);1==t.status?new MameToastSticky(t.message,"success"):new MameToastSticky(t.message,"error")}))}),e(document).on("click","#mame_tw-settle-transaction-btn",function(t){t.preventDefault();var a=confirm(twintVars.texts.confirmSettlement);if(a){var n=e(this),s=n.data("order-id");n.prop("disabled",!0),e.when(e.post(twintVars.ajaxUrl,{action:"mametw_ajax",mame_tw_action:"settle_transaction",security:twintVars.ajaxNonce,order_id:s}).then(function(e){n.prop("disabled",!1);var t=JSON.parse(e);1==t.status?new MameToastSticky(t.message,"success"):new MameToastSticky(t.message,"error"),new r(t)}))}}),e(document).on("click","#mame_tw-cancel-transaction-btn",function(t){t.preventDefault();var a=confirm(twintVars.texts.confirmCancellation);if(a){var n=e(this),s=n.data("order-id");n.prop("disabled",!0),e.when(e.post(twintVars.ajaxUrl,{action:"mametw_ajax",mame_tw_action:"cancel_transaction",security:twintVars.ajaxNonce,order_id:s}).then(function(e){n.prop("disabled",!1);var t=JSON.parse(e);1==t.status?new MameToastSticky(t.message,"success"):new MameToastSticky(t.message,"error"),new r(t)}))}}),e(".mame_tw-create_certificate_button").click(function(t){t.preventDefault();var a=e(this).data("environment");e.when(e.post(twintVars.ajaxUrl,{action:"mametw_ajax",mame_tw_action:"save_file",security:twintVars.ajaxNonce,environment:a,content:e("textarea[name='mametw_settings_cert_"+a+"']").serialize()}).then(function(t){var n=JSON.parse(t);1==n.status?(new MameToast(n.message,"success"),e(".mame_tw-certificate-upload-wrapper ."+a).show()):new MameToast(n.message,"error")}))}),e(".mame_tw-upload_file_button").click(function(t){t.preventDefault();var a=e(this).data("environment"),n=wp.media.editor.send.attachment,s=e(this);return wp.media.editor.send.attachment=function(t,i){e(s).prev().val(i.id),wp.media.editor.send.attachment=n,e.when(e.post(twintVars.ajaxUrl,{action:"mametw_ajax",mame_tw_action:"convert",security:twintVars.ajaxNonce,attachment_id:i.id,environment:a}).then(function(e){var t=JSON.parse(e);1==t.status?new MameToast(t.message,"success"):new MameToast(t.message,"error")}))},wp.media.editor.open(s),!1}),e("input[name='mametw_check_certificate_expiration']").click(function(t){t.preventDefault();var a=e(this);a.prop("disabled",!0),e.when(e.post(twintVars.ajaxUrl,{mame_tw_action:"check_expiry",action:"mametw_ajax",security:twintVars.ajaxNonce}).then(function(e){a.prop("disabled",!1);var t=JSON.parse(e);1==t.status?new MameToast(t.message,"success"):new MameToast(t.message,"error")}))}),e("input[name='mametw_renew_certificate']").click(function(e){e.preventDefault();var t=new MameTwDialog(twintVars.texts.renewCertificateTitle,twintVars.texts.renewCertificateText,"renew_certificate");t.open()}),e("input[name='mametw_enroll_register']").click(function(t){t.preventDefault(),i(e("select#mametw_settings_environment option:selected").val())});var l=function(t){this.phpVars=t;var a=this;e("."+this.phpVars.prefix+"-license-check-btn").click(function(e){e.preventDefault(),a.check_license()}),e("."+this.phpVars.prefix+"-license-activate-btn").click(function(e){e.preventDefault(),a.activate_license()}),e("."+this.phpVars.prefix+"-license-deactivate-btn").click(function(e){e.preventDefault(),a.deactivate_license()}),e("#"+this.phpVars.prefix+"-ignore-notice").click(function(e){e.preventDefault(),a.ignore_notice()})};if(l.prototype.show_loader=function(){e("#"+this.phpVars.prefix+"-license-field-wrapper").hide(),e("#"+this.phpVars.prefix+"-loader").show()},l.prototype.hide_loader=function(){e("#"+this.phpVars.prefix+"-loader").hide(),e("#"+this.phpVars.prefix+"-license-field-wrapper").show()},l.prototype.check_license=function(){this.show_loader();var t=this;e.ajax({type:"POST",url:t.phpVars.ajaxUrl,data:{action:t.phpVars.prefix+"_ajax_license",security:t.phpVars.ajaxNonce,license_action:"check"},success:function(a){var n=e.parseJSON(a);n.status?new MameToastSticky(n.message,"success"):(e("#"+t.phpVars.prefix+"-license-invalid").show(),e("#"+t.phpVars.prefix+"-license-valid").hide(),new MameToastSticky(n.message,"error")),t.hide_loader()},error:function(e){new MameToast(t.phpVars.texts.licenseCheckFailed,"error"),t.hide_loader()}})},l.prototype.activate_license=function(){this.show_loader();var t=this,a=e("#"+this.phpVars.prefix+"_license_key").val();e.ajax({type:"POST",url:t.phpVars.ajaxUrl,data:{action:t.phpVars.prefix+"_ajax_license",security:t.phpVars.ajaxNonce,license:a,license_action:"activate"},success:function(n){var s=e.parseJSON(n);s.status?(new MameToast(s.message,"success"),e("#"+t.phpVars.prefix+"-license-invalid").hide(),e("#"+t.phpVars.prefix+"-license-valid").show(),e("#"+t.phpVars.prefix+"-current-license-key").text(a)):new MameToastSticky(s.message,"error"),t.hide_loader()},error:function(e){new MameToast(t.phpVars.texts.licenseActivationFailed,"error"),t.hide_loader()}})},l.prototype.deactivate_license=function(){this.show_loader();var t=this;e.ajax({type:"POST",url:t.phpVars.ajaxUrl,data:{action:t.phpVars.prefix+"_ajax_license",security:t.phpVars.ajaxNonce,license_action:"deactivate"},success:function(a){var n=e.parseJSON(a);n.status?(new MameToast(n.message,"success"),e("#"+t.phpVars.prefix+"-license-invalid").show(),e("#"+t.phpVars.prefix+"-license-valid").hide()):new MameToastSticky(n.message,"error"),t.hide_loader()},error:function(e){new MameToast(t.phpVars.texts.licenseActivationFailed,"error"),t.hide_loader()}})},l.prototype.ignore_notice=function(){var t=this;e.when(e.post(t.phpVars.ajaxUrl,{action:t.phpVars.prefix+"_ajax_license",security:t.phpVars.ajaxNonce,license_action:"notice"}).then(function(a){var n=e.parseJSON(a);n.status&&e("#"+t.phpVars.prefix+"-ignore-notice").closest(".error").hide()},"json"))},e("."+twintVars.prefix+"-license-check-btn").length>0){new l(twintVars)}e("#mametw_settings_environment").change(function(){"test"===e("#mametw_settings_environment option:selected").val()?(e(".mametw-prod-settings").closest("tr").hide(),e(".mametw-test-settings").closest("tr").show()):(e(".mametw-test-settings").closest("tr").hide(),e(".mametw-prod-settings").closest("tr").show())}).trigger("change"),"function"!=typeof MameToast&&(window.MameToast=function(t,a){this.message=t,e("body").append("<p id='mame-toast' class='mame-toast show "+a+"'>"+t+"</p>"),setTimeout(function(){e("#mame-toast").removeClass("show"),setTimeout(function(){e("#mame-toast").remove()},1e3)},5e3)}),"function"!=typeof MameToastSticky&&(window.MameToastSticky=function(t,a){this.message=t;var n=e("#mame-toast-sticky");n.length&&n.remove(),e("body").append("<div id='mame-toast-sticky' class='mame-toast-sticky show "+a+"'><div class='mame-toast-sticky-inner'><p>"+t+"</p><button id='mame-toast-close' class='"+a+"'>x</button></div></div>")},e(document).on("click","#mame-toast-close",function(t){t.preventDefault(),e("#mame-toast-sticky").removeClass("show"),e("#mame-toast-sticky").remove()})),window.MameTwDialog=function(t,a,n){this.text=a,this.title=t,this.type=n;var s=this;"renew_certificate"===n&&(this.callback=this.renewCertificate),e(document).on("click","#mame_tw-modal-cancel",function(e){e.preventDefault(),s.close()})},MameTwDialog.prototype={open:function(){e("#mame_tw-modal-content .title").empty(),e("#mame_tw-modal-content .text").empty(),e("#mame_tw-modal-content .title").html(this.title),e("#mame_tw-modal-content .text").html(this.text),e("#mame_tw-modal").removeClass("hidden");var t=this;e(document).on("click","#mame_tw-modal-confirm",function(a){a.preventDefault(),t.callback(e(this))})},close:function(){e("#mame_tw-modal").addClass("hidden"),e(document).off("click","#mame_tw-modal-confirm")},renewCertificate:function(t){var a=this;t.prop("disabled",!0),e.when(e.post(twintVars.ajaxUrl,a.getRequestParams("renew_certificate")).then(function(e){t.prop("disabled",!1),a.handleResponse(e),a.close()},"json"))},getRequestParams:function(e){return{action:"mametw_ajax",mame_tw_action:e,security:twintVars.ajaxNonce}},handleResponse:function(e){var t=JSON.parse(e);1==t.status?new MameToast(t.message,"success"):new MameToast(t.message,"error")}}});